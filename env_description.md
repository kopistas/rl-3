# Разработка и тестирование среды для задачи управления температурой

## 1. Выбор задачи

### 1.1 Описание проблемы
Выбрана задача оптимального управления температурой в помещении с помощью обогревателя. Эта задача имеет практическое применение в системах "умного дома" и промышленной автоматизации.

### 1.2 Обоснование выбора
- **Практическая значимость**: Эффективное управление температурой напрямую влияет на энергопотребление и комфорт.
- **Сложность задачи**: Присутствует баланс между комфортом (поддержание целевой температуры) и эффективностью (минимизация использования обогревателя).
- **Применимость RL**: Задача имеет:
  - Четкое определение состояний и действий
  - Измеримую целевую функцию (награду)
  - Временную составляющую (необходимость планирования)
  - Стохастичность (влияние внешней температуры)

## 2. Реализация среды

### 2.1 Структура среды
Среда реализована на базе OpenAI Gymnasium и имеет следующие характеристики:

#### Состояния (State space):
- Текущая температура в помещении
- Целевая температура
- Внешняя температура


```python
self.observation_space = spaces.Box(
    low=np.array([self.min_temp, self.min_temp, -20.0]),
    high=np.array([self.max_temp, self.max_temp, 40.0]),
    dtype=np.float32
)
```

#### Действия (Action space):
- Бинарное управление обогревателем (включен/выключен)


```python
self.action_space = spaces.Discrete(2)
```

#### Физическая модель:
- **Нагрев**: При включении обогревателя температура повышается с учетом инерции


  ```python
  temp_change = self.heater_power * self.time_step * (1 - self.heating_inertia)
  ```
- **Охлаждение**: Постоянный теплообмен с внешней средой


  ```python
  heat_loss = self.heat_loss_rate * (self.external_temp - self.current_temp) * self.time_step
  ```
- **Внешняя температура**: Моделируется синусоидой для имитации суточных колебаний


  ```python
  self.external_temp = 18.0 + 5 * np.sin(2 * np.pi * self.time / 24.0)
  ```

### 2.2 Система наград
Награда состоит из двух компонентов:

1. Отрицательная награда за отклонение от целевой температуры:


   ```python
   base_reward = -abs(self.current_temp - self.target_temp)
   ```
   
2. Штраф за использование обогревателя:


   ```python
   heater_penalty = -0.1 if action == 1 else 0
   ```

## 3. Тестирование среды

### 3.1 Разработанные тесты
Создан набор модульных тестов для проверки всех аспектов среды:

1. **Физическая модель**:
   - Тест нагрева (`test_environment_dynamics_up`)
   - Тест охлаждения (`test_environment_cooling`)
   - Тест инерции (`test_heating_inertia`)

2. **Ограничения и граничные условия**:
   - Проверка границ температуры (`test_environment_bounds`)
   - Проверка временного лимита (`test_episode_time_limit`)

3. **Система наград**:
   - Тест механизма наград (`test_reward_mechanism`)
   - Тест штрафов за обогреватель (`test_heater_penalty`)
   - Тест накопления штрафов (`test_penalty_accumulation`)


### 3.2 Параметры среды
Финальные значения ключевых параметров:

```python
heat_loss_rate = 0.2    # Скорость теплопотерь
heater_power = 2.0      # Мощность обогревателя
heating_inertia = 0.5   # Инерция нагрева
time_step = 0.1         # Шаг времени (часы)
```
